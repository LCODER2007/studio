
{
  "entities": {
    "Suggestion": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Suggestion",
      "type": "object",
      "description": "Represents a suggestion submitted by a user.",
      "properties": {
        "suggestionId": {
          "type": "string",
          "description": "Unique identifier for the suggestion entity."
        },
        "title": {
          "type": "string",
          "description": "Title of the suggestion.",
          "format": "string"
        },
        "body": {
          "type": "string",
          "description": "Detailed description of the suggestion.",
          "format": "string"
        },
        "authorUid": {
          "type": "string",
          "description": "Reference to the User who created the suggestion. Can also be 'ANONYMOUS'."
        },
        "authorDisplayName": {
          "type": "string",
          "description": "Display name of the user who created the suggestion."
        },
        "authorPhotoURL": {
          "type": "string",
          "description": "Photo URL of the user who created the suggestion."
        },
        "category": {
          "type": "string",
          "description": "Category of the suggestion (ACADEMIC_CURRICULUM, INFRASTRUCTURE_IT, TECHNICAL_DESIGN, ENVIRONMENTAL_SUSTAINABILITY, ADMINISTRATIVE_SEES, OTHER).",
          "format": "string"
        },
        "upvotesCount": {
          "type": "number",
          "description": "Number of upvotes for the suggestion."
        },
        "impactScore": {
          "type": "number",
          "description": "Impact score of the suggestion (1-5, admin rated)."
        },
        "feasibilityRating": {
          "type": "number",
          "description": "Feasibility rating of the suggestion (1-5, admin rated)."
        },
        "costEffectivenessRating": {
          "type": "number",
          "description": "Cost-effectiveness rating of the suggestion (1-5, admin rated)."
        },
        "reviewerUid": {
          "type": "string",
          "description": "Reference to the User (Admin) who reviewed the suggestion."
        },
        "submissionTimestamp": {
          "type": "string",
          "description": "Timestamp of when the suggestion was submitted.",
          "format": "date-time"
        },
        "publicFeedback": {
          "type": "string",
          "description": "Public feedback on the suggestion."
        }
      },
      "required": [
        "suggestionId",
        "title",
        "body",
        "authorUid",
        "authorDisplayName",
        "category",
        "upvotesCount",
        "submissionTimestamp"
      ]
    },
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user profile.",
      "properties": {
        "uid": {
          "type": "string",
          "description": "Unique identifier for the user entity."
        },
        "email": {
          "type": "string",
          "description": "Email address of the user.",
          "format": "email"
        },
        "displayName": {
          "type": "string",
          "description": "Display name of the user."
        },
        "role": {
          "type": "string",
          "description": "Role of the user (STUDENT, SUPER_ADMIN)."
        }
      },
      "required": [
        "uid",
        "email"
      ]
    },
    "Vote": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Vote",
      "type": "object",
      "description": "Represents a user's vote on a suggestion.",
      "properties": {
        "suggestionId": {
          "type": "string",
          "description": "Reference to the Suggestion being voted on. (Relationship: Suggestion 1:N Vote)"
        },
        "voterUid": {
          "type": "string",
          "description": "Reference to the User who cast the vote. (Relationship: User 1:N Vote)"
        },
        "timestamp": {
          "type": "string",
          "description": "Timestamp of when the vote was cast.",
          "format": "date-time"
        },
        "voteId": {
          "type": "string",
          "description": "Unique identifier for the vote entity."
        }
      },
      "required": [
        "suggestionId",
        "voterUid",
        "timestamp",
        "voteId"
      ]
    },
    "UserVote": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User Vote",
      "description": "A document representing a single vote by a user on a suggestion.",
      "type": "object",
      "properties": {
          "suggestionId": {
              "type": "string",
              "description": "The ID of the suggestion that was voted on."
          }
      },
      "required": ["suggestionId"]
    },
     "Comment": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Comment",
      "type": "object",
      "description": "Represents a comment on a suggestion.",
      "properties": {
        "commentId": {
          "type": "string",
          "description": "Unique identifier for the comment entity."
        },
        "suggestionId": {
          "type": "string",
          "description": "Reference to Suggestion. Unique identifier of the suggestion being commented on."
        },
        "authorUid": {
          "type": "string",
          "description": "Reference to User. Unique identifier of the user who wrote the comment."
        },
        "authorDisplayName": {
          "type": "string",
          "description": "Display name of the user who wrote the comment."
        },
        "authorPhotoURL": {
          "type": "string",
          "description": "Photo URL of the user who wrote the comment."
        },
        "body": {
          "type": "string",
          "description": "Content of the comment."
        },
        "timestamp": {
          "type": "string",
          "description": "Timestamp of when the comment was posted.",
          "format": "date-time"
        }
      },
      "required": [
        "commentId",
        "suggestionId",
        "authorUid",
        "authorDisplayName",
        "body",
        "timestamp"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "google.com"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{uid}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profile information, including the user's role. Used to determine authorization for various actions. Includes denormalized 'role' for authorization independence.",
          "params": [
            {
              "name": "uid",
              "description": "The unique identifier of the user."
            }
          ]
        }
      },
      {
        "path": "/suggestions/{suggestionId}",
        "definition": {
          "entityName": "Suggestion",
          "schema": {
            "$ref": "#/backend/entities/Suggestion"
          },
          "description": "Stores suggestions submitted by users. 'authorUid' is used to track the suggestion's author; can be 'ANONYMOUS' for anonymous submissions. Includes fields for admin evaluation (impactScore, feasibilityRating, costEffectivenessRating).",
          "params": [
            {
              "name": "suggestionId",
              "description": "The unique identifier of the suggestion."
            }
          ]
        }
      },
      {
        "path": "/users/{uid}/user_votes/{suggestionId}",
        "definition": {
          "entityName": "UserVote",
          "schema": {
            "$ref": "#/backend/entities/UserVote"
          },
          "description": "A subcollection to track which suggestions a user has voted for. This allows for efficient and secure checking of a user's vote status.",
          "params": [
            {
                "name": "uid",
                "description": "The unique identifier of the user."
            },
            {
                "name": "suggestionId",
                "description": "The unique identifier of the suggestion."
            }
          ]
        }
      },
      {
          "path": "/suggestions/{suggestionId}/comments/{commentId}",
          "definition": {
              "entityName": "Comment",
              "schema": {
                  "$ref": "#/backend/entities/Comment"
              },
              "description": "Subcollection storing comments for a specific suggestion. This model ensures that comments are loaded efficiently with the suggestion and simplifies security rules.",
              "params": [
                  {
                      "name": "suggestionId",
                      "description": "The unique identifier of the parent suggestion."
                  },
                  {
                      "name": "commentId",
                      "description": "The unique identifier of the comment."
                  }
              ]
          }
      }
    ],
    "reasoning": "The Firestore data structure is designed to ensure security, scalability, and debuggability. The `/users` collection stores profiles with roles for authorization. The `/suggestions` collection is flat for easy querying and public readability. To handle user-specific actions without compromising security, a `/users/{uid}/user_votes` subcollection tracks upvotes, preventing users from manipulating others' votes. Comments are stored in a subcollection under each suggestion (`/suggestions/{suggestionId}/comments`) for efficient retrieval and clear ownership context, simplifying security rules by scoping them to the parent suggestion."
  }
}
